# This template along with variable assignments generated by makeBBoxSpreadsheet.sh
# are used to create a script that will interactively repair shows listed in $REPAIR_SHOWS

# Script copied from repairBBoxTemplate.sh

echo "Attempting to repair shows with possible missing episodes."
echo "You will be given a chance to repair each show individually"
echo "based on comparing the show counts on original and repaired .csv files."
echo ""
echo "Backups will be saved as $EPISODES_BACKUP_FILE"
echo "and $SEASONS_BACKUP_FILE"
echo ""

if [ ! -e $REVISED_EPISODES_FILE ]; then
    echo "[Error] Can't find $REVISED_EPISODES_FILE"
    echo "Create one by scraping with $REPAIR_EPISODES_FILE"
    exit 1
fi
if [ ! -e $REVISED_SEASONS_FILE ]; then
    echo "[Error] can't find $REVISED_SEASONS_FILE"
    echo "Create one by scraping with $REPAIR_SEASONS_FILE"
    exit 1
fi

# Save a backup
cp $EPISODES_FILE $EPISODES_BACKUP_FILE
cp $SEASONS_FILE $SEASONS_BACKUP_FILE

# Loop through shows in $REPAIR_SHOWS
# Use FD 3 so you can prompt on STDIN
while read -r -u 3 line; do
    echo "### Differences in counts of $line episodes"
    grep -c $line $EPISODES_FILE $REVISED_EPISODES_FILE
    awk -f fixExtraLinesFrom-webscraper.awk $EPISODES_FILE | grep -v $line >$TEMP_FILE
    read -r -p "Attempt repair of $line episodes? [y/N] " YESNO
    if [ "$YESNO" != "y" ]; then
        echo "Skipping..."
    else
        echo "Repairing ..."
        cp $TEMP_FILE $EPISODES_FILE
        awk -f fixExtraLinesFrom-webscraper.awk $REVISED_EPISODES_FILE | grep $line >>$EPISODES_FILE
    fi
    rm -f $TEMP_FILE
    #
    echo ""
    echo "### Differences in counts of $line seasons"
    grep -c $line $SEASONS_FILE $REVISED_SEASONS_FILE
    awk -f fixExtraLinesFrom-webscraper.awk $SEASONS_FILE | grep -v $line >$TEMP_FILE
    read -r -p "Attempt repair of $line seasons? [y/N] " YESNO
    if [ "$YESNO" != "y" ]; then
        echo "Skipping..."
    else
        echo "Repairing ..."
        cp $TEMP_FILE $SEASONS_FILE
        awk -f fixExtraLinesFrom-webscraper.awk $REVISED_SEASONS_FILE | grep $line >>$SEASONS_FILE
    fi
    rm -f $TEMP_FILE
    echo ""

done 3<"$REPAIR_SHOWS"
